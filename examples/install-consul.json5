{
  vars: {
    consulVersion: "1.2.3",
    consulZipFile: "{{HOME}}/downloads/consul_1.2.3_linux_amd64.zip",
    consulUnzipDir: "{{HOME}}/downloads/consul_1.2.3",
  },
  assertions: [
    {
      description: "Ensure downloads directory exists",
      assert: "DirectoryExists",
      with: {
        path: "{{HOME}}/downloads",
      },
    },
    {
      description: "Download consul zip file",
      assert: "FileDownloaded",
      with: {
        url: "https://releases.hashicorp.com/consul/${consulVersion}/consul_${consulVersion}_linux_amd64.zip",
        checksum: "658f4f3b305cd357a9501728b8a1dc5f",
        checksumType: "etag",
        toFile: "${consulZipFile}",
      },
    },
    {
      description: "Unzip consul",
      assert: "DirectoryUnzipped",
      with: {
        zipFile: "${consulZipFile}",
        toDir: "${consulUnzipDir}",
        expectFile: "consul",
      },
    },
    {
      description: "move binaries into bin dir",
      assert: "FileCopied",
      runAs: "sudo",
      with: {
        fromPath: "${consulUnzipDir}/consul",
        toDir: "/usr/local/bin/consul",
      },
    },
    {
      description: "make consul executable",
      assert: "FileModeSet",
      runAs: "sudo",
      with: {
        path: "/usr/local/bin/consul",
        mode: "777",
      },
    },
    {
      description: "Verify expected version (${consulVersion})",
      assert: "CommandOutputs",
      with: {
        command: "consul --version",
        regex: "^Consul\\sv${consulVersion}",
        occurrence: 1,
      },
    },
  ],
}
